<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mortgage Payment Calculator (UK) | mortgage-cal.uk</title>
  <link rel="canonical" href="https://mortgage-cal.uk/calculators/mortgage-payment.html" />
  <meta name="description" content="UK mortgage payment calculator: repayment or interest-only, monthly/weekly/fortnightly, offset mortgage and optional shared ownership rent. No cookies." />
  <link rel="stylesheet" href="../src/site.css" />
  <style>
    /* Page-specific tweaks */
    .callout{background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.45);border-radius:14px;padding:10px 12px;margin-top:10px}
    .callout-title{font-weight:800;font-size:13px;margin:0 0 6px}
    .callout-body{color:var(--muted);font-size:12px;line-height:1.45;margin:0}
    .toggle-row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px;border:1px dashed var(--line);border-radius:14px;background:#0e1730}
    .switch{position:relative;width:46px;height:28px;flex:0 0 auto}
    .switch input{display:none}
    .slider{position:absolute;inset:0;background:rgba(11,36,71,.85);border:1px solid var(--inputBorder);border-radius:999px;cursor:pointer;transition:.2s}
    .slider:before{content:"";position:absolute;height:22px;width:22px;left:3px;top:2px;background:#cbd5ff;border-radius:999px;transition:.2s}
    .switch input:checked + .slider{background:var(--good);border-color:var(--good)}
    .switch input:checked + .slider:before{transform:translateX(18px);background:#06220f}
    table{width:100%;border-collapse:collapse;font-size:12px}
    th,td{padding:8px 6px;border-bottom:1px solid var(--line);text-align:left;white-space:nowrap}
  </style>
</head>
<body>
  <header class="header">
    <h1 class="h1">Mortgage payment calculator</h1>
    <p class="sub">Mobile-first, UK-focused. Offset mortgages + optional shared ownership rent. No cookies.</p>
  </header>

  <nav class="nav" aria-label="Site sections">
    <div class="tabs">
      <a class="tab" href="../index.html">Home</a>
      <a class="tab active" href="./index.html">Calculators</a>
      <a class="tab" href="../articles.html">Articles</a>
      <a class="tab" href="../news.html">News</a>
      <a class="tab" href="../privacy.html">Privacy</a>
    </div>
  </nav>

  <main class="wrap grid">
    <section class="card">
      <div class="title">Inputs</div>

      <div class="row">
        <div class="field">
          <label for="price">Property price (£)</label>
          <input id="price" type="number" min="0" step="1000" value="400000">
        </div>
        <div class="field">
          <label for="downPct">Down payment (%)</label>
          <input id="downPct" type="number" min="0" max="100" step="0.1" value="10">
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="rate">Yearly mortgage rate (%)</label>
          <input id="rate" type="number" min="0" step="0.01" value="4.5">
        </div>
        <div class="field">
          <label for="years">Mortgage term (years)</label>
          <input id="years" type="number" min="1" step="1" value="30">
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="type">Payment type</label>
          <select id="type">
            <option value="repayment" selected>Repayment (capital + interest)</option>
            <option value="interestOnly">Interest-only</option>
          </select>
        </div>
        <div class="field">
          <label for="frequency">Repayment frequency</label>
          <select id="frequency">
            <option value="monthly" selected>Monthly</option>
            <option value="fortnightly">Fortnightly</option>
            <option value="weekly">Weekly</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="offsetBalance">Offset balance (£)</label>
          <input id="offsetBalance" type="number" min="0" step="100" value="0">
        </div>
      </div>

      <div class="callout" role="note" aria-label="Offset mortgage explainer">
        <div class="callout-title">Offset mortgage (how we model it)</div>
        <p class="callout-body">
          We reduce the balance used for interest: <strong>effective principal = max(0, remaining − offset)</strong>.
          Payment amount stays the same for a standard repayment mortgage (offset changes the interest/principal split).
          <a href="#" id="toggleOffsetExplainer">Show details ↓</a>
        </p>
      </div>

      <div id="offsetExplainer" class="card" style="display:none;margin-top:10px;">
        <div class="title">Offset details</div>
        <p class="note" style="margin:0;">
          Assumptions: offset balance is constant; interest is calculated each period on the effective principal.
          This is a simplified model — lender implementations can vary.
        </p>
      </div>

      <div class="toggle-row" style="margin: 10px 0;">
        <div>
          <div style="font-weight:800;">Shared ownership</div>
          <div class="small">If enabled, mortgage is calculated on the owned share; rent is added for the unowned share.</div>
        </div>
        <label class="switch" aria-label="Shared ownership">
          <input id="sharedToggle" type="checkbox">
          <span class="slider"></span>
        </label>
      </div>

      <div id="ownershipBlock" style="display:none;">
        <div class="row">
          <div class="field">
            <label for="ownPct">Ownership (%)</label>
            <input id="ownPct" type="number" min="1" max="100" step="1" value="50">
          </div>
          <div class="field">
            <label for="rentRatePct">Unowned share rent rate (%)</label>
            <input id="rentRatePct" type="number" min="0" step="0.01" value="2.7">
          </div>
        </div>
        <p class="note" style="margin-top:0;">Rent rate is an annual % charged on the unowned share (default 2.7%).</p>
      </div>

      <div class="btns">
        <button id="calcBtn">Calculate</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>

      <div id="error" class="err" role="alert" aria-live="polite"></div>
      <p class="note">Tip: for shareable scenarios, this page can encode inputs into the URL (no cookies). That’s optional and visible in your address bar.</p>
    </section>

    <section class="card sticky">
      <div class="title">Results</div>
      <div class="kpis">
        <div class="metric"><div class="k">Mortgage payment (per frequency)</div><div class="v" id="mortgagePayment">—</div></div>
        <div class="metric"><div class="k">Interest this period (after offset)</div><div class="v" id="interestThisPeriod">—</div></div>
        <div class="metric"><div class="k">Estimated payoff time (offset)</div><div class="v" id="payoffTime">—</div></div>
        <div class="metric"><div class="k">Shared ownership rent (monthly)</div><div class="v" id="rentMonthly">—</div></div>
        <div class="metric"><div class="k">Total outpay (mortgage + rent)</div><div class="v" id="totalOutpay">—</div></div>
      </div>

      <div class="hr"></div>
      <a class="tab" href="#" id="toggleSchedule">Show schedule ↓</a>

      <div id="scheduleWrap" style="margin-top:10px; display:none;">
        <div class="title">Amortization schedule (first 24 periods)</div>
        <div style="overflow:auto;">
          <table>
            <thead>
              <tr>
                <th>Period</th>
                <th>Payment</th>
                <th>Interest</th>
                <th>Principal</th>
                <th>Balance</th>
                <th>Effective principal</th>
              </tr>
            </thead>
            <tbody id="scheduleBody"></tbody>
          </table>
        </div>
        <p class="note" style="margin:10px 0 0;">Showing first 24 periods only. Offset assumed constant.</p>
      </div>

      <p class="note" style="margin-top:12px;">Disclaimer (2026): Estimates only; not financial advice.</p>
    </section>
  </main>

<script type="module">
  import { buildSchedule, periodsPerYear } from "../src/mortgage.js";

  const el = (id) => document.getElementById(id);
  const fmtGBP = (x) => {
    if (!isFinite(x)) return "—";
    return new Intl.NumberFormat("en-GB", { style:"currency", currency:"GBP", maximumFractionDigits: 2 }).format(x);
  };

  // --- No-cookie state in URL helpers ---
  function b64urlEncode(str) {
    return btoa(unescape(encodeURIComponent(str)))
      .replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/g, "");
  }
  function b64urlDecode(str) {
    const padLen = (4 - (str.length % 4)) % 4;
    const padded = str.replace(/-/g, "+").replace(/_/g, "/") + "=".repeat(padLen);
    return decodeURIComponent(escape(atob(padded)));
  }

  function validateNumber(name, value, {min=-Infinity, max=Infinity}={}) {
    if (value === "" || value === null || value === undefined || Number.isNaN(value)) return `${name} is required.`;
    if (value < min) return `${name} must be at least ${min}.`;
    if (value > max) return `${name} must be at most ${max}.`;
    return null;
  }

  function calcSharedRentMonthly(propertyPrice, ownershipPct, rentRatePct) {
    const unownedValue = propertyPrice * (1 - (ownershipPct / 100));
    const annualRent = unownedValue * (rentRatePct / 100);
    return annualRent / 12;
  }

  function getState() {
    return {
      price: el("price").value,
      downPct: el("downPct").value,
      rate: el("rate").value,
      years: el("years").value,
      type: el("type").value,
      frequency: el("frequency").value,
      offsetBalance: el("offsetBalance").value,
      shared: el("sharedToggle").checked ? 1 : 0,
      ownPct: el("ownPct").value,
      rentRatePct: el("rentRatePct").value,
    };
  }
  function applyState(state) {
    if (!state || typeof state !== "object") return;
    if (state.price != null) el("price").value = state.price;
    if (state.downPct != null) el("downPct").value = state.downPct;
    if (state.rate != null) el("rate").value = state.rate;
    if (state.years != null) el("years").value = state.years;
    if (state.type != null) el("type").value = state.type;
    if (state.frequency != null) el("frequency").value = state.frequency;
    if (state.offsetBalance != null) el("offsetBalance").value = state.offsetBalance;

    const shared = state.shared === 1 || state.shared === "1" || state.shared === true || state.shared === "true";
    el("sharedToggle").checked = shared;
    el("ownershipBlock").style.display = shared ? "block" : "none";
    if (state.ownPct != null) el("ownPct").value = state.ownPct;
    if (state.rentRatePct != null) el("rentRatePct").value = state.rentRatePct;
  }

  function writeUrlState() {
    const u = new URL(window.location.href);
    u.searchParams.set("state", b64urlEncode(JSON.stringify(getState())));
    window.history.replaceState({}, "", u.pathname + u.search);
  }

  function renderSchedule(schedule) {
    const tbody = el("scheduleBody");
    const rows = schedule.slice(0, 24).map((r) => `
      <tr>
        <td>${r.period}</td>
        <td>${fmtGBP(r.payment)}</td>
        <td>${fmtGBP(r.interest)}</td>
        <td>${fmtGBP(r.principalPaid)}</td>
        <td>${fmtGBP(r.balance)}</td>
        <td>${fmtGBP(r.effectivePrincipal)}</td>
      </tr>`).join("");
    tbody.innerHTML = rows;
  }

  function calc() {
    el("error").textContent = "";

    const price = Number(el("price").value);
    const downPct = Number(el("downPct").value);
    const rate = Number(el("rate").value);
    const years = Number(el("years").value);
    const type = el("type").value;
    const frequency = el("frequency").value;
    const offsetBalance = Number(el("offsetBalance").value);

    const shared = el("sharedToggle").checked;
    const ownPct = shared ? Number(el("ownPct").value) : 100;
    const rentRatePct = shared ? Number(el("rentRatePct").value) : 0;

    const errs = [
      validateNumber("Property price", price, {min:0}),
      validateNumber("Down payment (%)", downPct, {min:0, max:100}),
      validateNumber("Yearly mortgage rate (%)", rate, {min:0}),
      validateNumber("Mortgage term (years)", years, {min:1}),
      validateNumber("Offset balance (£)", offsetBalance, {min:0}),
      shared ? validateNumber("Ownership (%)", ownPct, {min:1, max:100}) : null,
      shared ? validateNumber("Unowned share rent rate (%)", rentRatePct, {min:0, max:100}) : null,
    ].filter(Boolean);

    if (errs.length) {
      el("error").textContent = errs[0];
      el("mortgagePayment").textContent = "—";
      el("interestThisPeriod").textContent = "—";
      el("payoffTime").textContent = "—";
      el("rentMonthly").textContent = "—";
      el("totalOutpay").textContent = "—";
      el("scheduleBody").innerHTML = "";
      return;
    }

    const ownedValue = price * (ownPct / 100);
    const depositAmt = ownedValue * (downPct / 100);
    const principal = ownedValue - depositAmt;

    if (principal < 0) {
      el("error").textContent = "Deposit cannot exceed the owned value of the property.";
      return;
    }

    const rentMonthly = shared ? calcSharedRentMonthly(price, ownPct, rentRatePct) : 0;
    const ppy = periodsPerYear(frequency);
    const rentPerPeriod = rentMonthly * 12 / ppy;

    const { payment, schedule } = buildSchedule({
      principal,
      annualRatePct: rate,
      years,
      frequency,
      type,
      offsetBalance,
    });

    const totalOutpay = payment + rentPerPeriod;

    el("mortgagePayment").textContent = fmtGBP(payment);
    el("interestThisPeriod").textContent = fmtGBP(schedule[0]?.interest ?? 0);
    const payoffPeriods = schedule.length;
    const payoffYears = payoffPeriods / ppy;
    el("payoffTime").textContent = payoffPeriods ? `${payoffPeriods} periods (~${payoffYears.toFixed(1)}y)` : "—";
    el("rentMonthly").textContent = fmtGBP(rentMonthly);
    el("totalOutpay").textContent = fmtGBP(totalOutpay);

    renderSchedule(schedule);
    writeUrlState();
  }

  function reset() {
    el("price").value = 400000;
    el("downPct").value = 10;
    el("rate").value = 4.5;
    el("years").value = 30;
    el("type").value = "repayment";
    el("frequency").value = "monthly";
    el("offsetBalance").value = 0;

    el("sharedToggle").checked = false;
    el("ownershipBlock").style.display = "none";
    el("ownPct").value = 50;
    el("rentRatePct").value = 2.7;

    el("scheduleBody").innerHTML = "";
    el("error").textContent = "";

    const u = new URL(window.location.href);
    u.searchParams.delete("state");
    window.history.replaceState({}, "", u.pathname + u.search);
    calc();
  }

  // init from URL state
  (function initFromUrlState(){
    const u = new URL(window.location.href);
    const s = u.searchParams.get("state");
    if (!s) return;
    try { applyState(JSON.parse(b64urlDecode(s))); } catch(e) {}
  })();

  // live sync
  ["price","downPct","rate","years","type","frequency","offsetBalance","sharedToggle","ownPct","rentRatePct"].forEach((id)=>{
    const node = el(id);
    const evt = (node.tagName === "SELECT" || node.type === "checkbox") ? "change" : "input";
    node.addEventListener(evt, ()=>{
      if (id === "sharedToggle") el("ownershipBlock").style.display = node.checked ? "block" : "none";
      calc();
    });
  });

  el("calcBtn").addEventListener("click", (e)=>{e.preventDefault();calc();});
  el("resetBtn").addEventListener("click", (e)=>{e.preventDefault();reset();});

  el("toggleSchedule").addEventListener("click", (e)=>{
    e.preventDefault();
    const wrap = el("scheduleWrap");
    const open = wrap.style.display !== "none";
    wrap.style.display = open ? "none" : "block";
    el("toggleSchedule").textContent = open ? "Show schedule ↓" : "Hide schedule ↑";
  });

  el("toggleOffsetExplainer").addEventListener("click", (e)=>{
    e.preventDefault();
    const box = el("offsetExplainer");
    const open = box.style.display !== "none";
    box.style.display = open ? "none" : "block";
    el("toggleOffsetExplainer").textContent = open ? "Show details ↓" : "Hide details ↑";
  });

  calc();
</script>
</body>
</html>
